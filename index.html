<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Chewing æ…¢é£Ÿä¼´ä¾£</title>
    <style>
        /* === 1. æ¢å¤åŸç‰ˆé£æ ¼ CSS === */
        :root {
            --primary: #4ecca3;
            --focus: #3b82f6;
            --rest: #f59e0b;
            --bg: #f8fafc;
            --text: #1e293b;
            --card: #ffffff;
            --gray-btn: #f1f5f9;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg); color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "PingFang SC", sans-serif;
            display: flex; flex-direction: column; height: 100dvh; overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* é¡¶éƒ¨ */
        header {
            padding: 15px 20px; padding-top: max(15px, env(safe-area-inset-top)); 
            display: flex; justify-content: space-between; align-items: center;
            background: var(--card); box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 100; flex-shrink: 0;
        }
        h1 { margin: 0; font-size: 1.2rem; font-weight: 600; color: #333; letter-spacing: 0.5px; }
        .header-right { display: flex; gap: 15px; }
        .icon-btn { background: none; border: none; font-size: 1.4rem; cursor: pointer; padding: 5px; opacity: 0.7; }

        /* ä¸»ä½“åœ†ç¯ - ä¿æŒåŸæ · */
        main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; width: 100%; }

        .stats-pill { position: absolute; top: 20px; background: rgba(0,0,0,0.05); padding: 8px 16px; border-radius: 30px; font-size: 0.9rem; font-weight: 500; color: #666; }
        .circle-container { width: min(260px, 70vw); height: min(260px, 70vw); position: relative; display: flex; justify-content: center; align-items: center; }
        .circle-bg { width: 100%; height: 100%; border-radius: 50%; background: #fff; box-shadow: 0 20px 40px rgba(0,0,0,0.08); position: absolute; transition: transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .circle-inner { width: 90%; height: 90%; border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 2; transition: background-color 0.5s ease; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .instruction-main { font-size: 1.8rem; font-weight: 600; text-align: center; }
        .instruction-sub { font-size: 1rem; opacity: 0.9; margin-top: 8px; }

        /* çŠ¶æ€åŠ¨ç”» */
        .state-bite .circle-bg { transform: scale(1); }
        .state-bite .circle-inner { background-color: var(--primary); }
        .state-chew .circle-inner { background-color: var(--focus); }
        .state-chew .circle-bg { background-color: rgba(59, 130, 246, 0.2); animation: pulseJaw 0.5s infinite alternate; }
        .state-rest .circle-bg { transform: scale(0.85); }
        .state-rest .circle-inner { background-color: var(--rest); }
        @keyframes pulseJaw { from { transform: scale(1); } to { transform: scale(1.15); } }

        /* åº•éƒ¨æ§åˆ¶ */
        .control-bar {
            background: var(--card); display: flex; justify-content: center; gap: 20px;
            border-radius: 30px 30px 0 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); flex-shrink: 0;
            padding: 30px; padding-bottom: max(30px, env(safe-area-inset-bottom) + 20px);
        }
        .btn { padding: 15px 30px; border-radius: 50px; border: none; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: transform 0.1s; min-width: 140px; letter-spacing: 1px; }
        .btn:active { transform: scale(0.96); }
        .btn-primary { background: #333; color: white; }
        .btn-secondary { background: #e2e8f0; color: #333; }
        .btn-danger { background: #fee2e2; color: #ef4444; }

        /* Modal åŸºç¡€æ ·å¼ (åŸç‰ˆ) */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none;
            justify-content: center; align-items: center; z-index: 200; backdrop-filter: blur(5px);
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white; width: 85%; max-width: 400px; border-radius: 24px; padding: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15); animation: fadeInScale 0.25s ease-out; position: relative;
        }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .close-btn-full { width: 100%; margin-top: 20px; padding: 12px; background: #eee; border:none; border-radius:12px; color:#555;}
        
        h2 { margin-top: 0; font-weight: 600; text-align: center; margin-bottom: 20px;}
        
        /* å†å²å’Œè®¾ç½®æ ·å¼çš„è¾…åŠ© CSS */
        .slider-group { position: relative; margin: 40px 0 20px 0; }
        .slider-wrapper { display: flex; align-items: center; gap: 15px; color: #999; font-size: 0.9rem; }
        input[type=range] { flex: 1; accent-color: var(--primary); width: 100%; }
        .range-bubble { position: absolute; bottom: 35px; left: 50%; transform: translateX(-50%); background: var(--primary); color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.9rem; pointer-events: none; }
        .history-list { max-height: 300px; overflow-y: auto; list-style: none; padding: 0; margin-top: 10px; }
        .history-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; font-size: 0.9rem; }

        /* === 2. ä¿®æ”¹ï¼šæ‰“èµä¸é—®å·çš„ CSS === */
        
        /* === 2. å…¨æ–° Dribbble é£æ ¼ï¼šæ‰“èµé¡µ === */
        
        /* è¿™é‡Œçš„ modal-content éœ€è¦è¦†ç›–åŸæœ‰çš„ç™½è‰²èƒŒæ™¯ */
        /* é€šè¿‡å…·ä½“çš„IDé€‰æ‹©å™¨æ¥æå‡ä¼˜å…ˆçº§ï¼Œè¥é€ æ¸©é¦¨æ°›å›´ */
        #modalGratuity .modal-content {
            background: #fffdf5; /* å¥¶æ²¹æš–ç±³è‰² */
            border-radius: 32px; /* æ›´å¤§çš„åœ†è§’ï¼Œæ›´æœ‰äº²å’ŒåŠ› */
            padding: 35px 25px;
            box-shadow: 
                0 20px 60px rgba(255, 159, 67, 0.15), /* æš–æ©™è‰²ç¯å¢ƒå…‰ */
                0 10px 20px rgba(0,0,0,0.05);
            border: 4px solid #fff; /* å†…ç™½è¾¹ï¼Œå¢åŠ ç²¾è‡´æ„Ÿ */
        }
        
        #pageSelect h2 {
            color: #5d4037; /* æš–å’–å•¡è‰²æ ‡é¢˜ */
            font-size: 1.4rem;
            margin-bottom: 5px;
            letter-spacing: -0.5px;
        }

        .warm-subtitle {
            text-align: center;
            color: #a1887f; /* æµ…å’–å•¡è‰² */
            font-size: 0.95rem;
            margin-bottom: 30px;
            font-weight: 500;
        }

        /* å¸ƒå±€å®¹å™¨ */
        .gratuity-row {
            display: grid;
            grid-template-columns: 1fr 1.1fr 1fr; /* ä¸­é—´ç¨å¤§ */
            gap: 15px;
            margin-bottom: 25px;
            align-items: stretch;
        }

        /* åŸºç¡€å¡ç‰‡æ ·å¼ - æ‹Ÿæ€/æ°”æ³¡æ„Ÿ */
        .g-card {
            position: relative;
            background: #fff;
            border-radius: 24px;
            padding: 15px 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); /* å¼¹æ€§æœå†»åŠ¨ç”» */
            border: 2px solid transparent;
            box-shadow: 
                0 4px 15px rgba(0,0,0,0.03), 
                inset 0 0 0 1px rgba(255,255,255,0.8);
            overflow: hidden;
        }

        /* é¼ æ ‡æ‚¬åœæ—¶çš„é€šæ•ˆï¼šä¸Šæµ®+æŠ•å½±åŠ æ·± */
        .g-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0,0,0,0.08);
            z-index: 10;
        }

        /* activeç‚¹å‡»æ€ */
        .g-card:active { transform: scale(0.95); }

        /* === è´´çº¸é£æ ¼çš„ 3D å›¾æ ‡ === */
        .sticker-icon {
            font-size: 2.8rem;
            margin-bottom: 8px;
            /* è®©Emojiçœ‹èµ·æ¥æœ‰åšåº¦å’ŒæŠ•å½± */
            filter: drop-shadow(0 4px 3px rgba(0,0,0,0.15)); 
            transform: rotate(-5deg); /* ä¿çš®çš„ä¸€ç‚¹ç‚¹æ­ª */
            transition: transform 0.3s;
        }
        .g-card:hover .sticker-icon { transform: rotate(5deg) scale(1.1); }

        .g-price { font-size: 1.8rem; font-weight: 800; color: #5d4037; margin-bottom: 2px; }
        .g-label { font-size: 1.3rem; color: #bcaaa4; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; }

        /* --- é£æ ¼ 1ï¼šå°æ‰“èµ (æ˜Ÿæ˜Ÿ/æŸ æª¬) --- */
        .g-card-1 {
            background: linear-gradient(135deg, #fff 0%, #fffde7 100%); /* æ·¡é»„ */
            border: 1px solid rgba(255, 241, 118, 0.3);
        }
        .g-card-1:hover { border-color: #fdd835; }
        .g-card-1 .g-price { color: #f9a825; }

        /* --- é£æ ¼ 2ï¼šå¤§çˆ±å¿ƒ (æ¨è) --- */
        .g-card-9 {
            background: linear-gradient(135deg, #fff0f3 0%, #fff 100%); /* æ·¡ç²‰æ¸å˜ */
            border: 2px solid #ffcdd2; /* é»˜è®¤æœ‰æ·¡ç²‰æ¡† */
            box-shadow: 0 10px 25px rgba(255, 64, 129, 0.15); /* ç²‰è‰²å…‰æ™• */
        }
        /* é€‰ä¸­/æ¨èçš„é«˜äº®çŠ¶æ€ */
        .g-card-9:hover {
            border-color: #ff4081; /* é²œè‰³ç²‰ */
            background: linear-gradient(135deg, #ffeef4 0%, #fff 100%);
        }
        .g-card-9 .g-price { color: #e91e63; font-size: 1.8rem; }
        .g-card-9 .g-label { color: #f48fb1; font-size: 1.3rem;}

        /* --- é£æ ¼ 3ï¼šé—®å· (ç´ é›…) --- */
        .g-card-survey {
            background: #f1f5f9;
        }
        .g-card-survey:hover { background: #e2e8f0; border-color: #cbd5e1;}
        .g-card-survey .g-price { color: #64748b; font-weight: 600; font-size: 1rem; }
        .g-card-survey .g-label { color: #94a3b8; }

        /* åº•éƒ¨â€œè·³è¿‡â€æŒ‰é’®é‡å†™ */
        .btn-text-only {
            background: transparent;
            color: #bcaaa4;
            border: none;
            width: 100%;
            padding: 15px;
            font-size: 0.9rem;
            cursor: pointer;
            text-decoration: underline;
            text-underline-offset: 4px;
            transition: color 0.2s;
        }
        .btn-text-only:hover { color: #8d6e63; }

        /* æ‰«ç é¡µç®€å•å¸ƒå±€ */
        /* === 3. ä¼˜åŒ–åçš„æ‰«ç é¡µ CSS === */
        #pagePay { display: none; flex-direction: column; align-items: center; padding-top: 10px; }
        
        /* ä»·æ ¼ä¸»æ ‡é¢˜ */
        .pay-header { font-size: 1rem; color: #666; margin-bottom: 15px; text-align: center; }
        .pay-amount-text { color: #1e293b; font-size: 1.5rem; font-weight: 700; font-family: -apple-system, sans-serif; }

        /* æ”¯ä»˜æ–¹å¼åˆ‡æ¢ Tabs */
        .pay-tabs { display: flex; gap: 12px; margin-bottom: 5px; background: #f1f5f9; padding: 4px; border-radius: 25px; }
        .tab-btn { 
            padding: 8px 24px; border: none; border-radius: 20px; 
            background: transparent; font-size: 0.9rem; font-weight: 500;
            cursor: pointer; color: #64748b; transition: 0.2s all;
        }
        .tab-btn.active { background: white; color: #333; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* äºŒç»´ç å®¹å™¨ - æ›´åŠ æ¸…æ™°å¤§æ–¹ */
        .qr-box { 
            width: 220px; height: 220px; /* åŠ å¤§å°ºå¯¸ï¼Œæ˜¾ç¤ºæ›´æ¸…æ™° */
            background: white; 
            padding: 10px; 
            border: 1px solid #f0f0f0; 
            border-radius: 16px; 
            margin: 20px 0; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.06); /* æ·»åŠ æ‚¬æµ®é˜´å½± */
            display: flex; align-items: center; justify-content: center;
        }
        .qr-img { 
            width: 100%; 
            height: 100%; 
            object-fit: contain; /* ä¿è¯å›¾ç‰‡æ¯”ä¾‹ä¸è¢«æ‹‰ä¼¸ï¼Œå®Œæ•´æ˜¾ç¤º */
            display: block; 
            image-rendering: -webkit-optimize-contrast; /* å°è¯•ä¼˜åŒ–å›¾ç‰‡æ¸²æŸ“ */
        }
        
        .verify-alert { font-size: 0.85rem; background: #fff7ed; color: #c2410c; padding: 8px 12px; border-radius: 8px; font-weight: 500;}
        /* === ä¿®å¤ï¼šé—®å·ä¸æŒ‰é’®æ ·å¼ (Dribbble é£æ ¼é€‚é…) === */
        
        /* é—®å·é—®é¢˜æ ‡é¢˜ */
        .survey-q-title { 
            display: block; 
            margin: 25px 0 12px 0; 
            font-weight: 700; 
            color: #5d4037; /* æ·±å’–è‰²ï¼Œå¢åŠ é˜…è¯»é‡åŠ› */
            font-size: 0.95rem; 
        }

        /* æ ‡ç­¾å®¹å™¨ */
        .tags-wrapper { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
            margin-bottom: 15px; 
        }
        
        /* æ ‡ç­¾èƒ¶å›Š - é»˜è®¤çŠ¶æ€ */
        .survey-tag {
            padding: 10px 18px;
            background: #fff;       /* ç™½è‰²èƒŒæ™¯ */
            border: 2px solid #ebdccc; /* æµ…å¥¶èŒ¶è‰²è¾¹æ¡† */
            border-radius: 50px;    /* åœ†æ¶¦èƒ¶å›Š */
            color: #8d6e63;         /* æ–‡å­—é¢œè‰² */
            font-size: 0.85rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            user-select: none;
            display: inline-block; /* ä¿®å¤æ¢è¡Œé—®é¢˜ */
        }
        
        /* é¼ æ ‡æ‚¬åœ */
        .survey-tag:hover {
            border-color: #d7ccc8;
            transform: translateY(-2px);
        }

        /* æ ‡ç­¾é€‰ä¸­çŠ¶æ€ (Active) - å˜ä¸ºå“ç‰Œç»¿è‰² */
        .survey-tag.active {
            background: var(--primary); /* ç»¿è‰²èƒŒæ™¯ */
            color: white;               /* ç™½å­— */
            border-color: var(--primary);
            box-shadow: 0 8px 15px rgba(78, 204, 163, 0.35); /* ç»¿è‰²æŠ•å½± */
            transform: scale(1.05); /* ç¨å¾®å˜å¤§ï¼Œå¢åŠ ç¡®è®¤æ„Ÿ */
        }

        /* ä¿®å¤åº•éƒ¨çš„æŒ‰é’®æ˜¾ç¤º */
        .modal-action-btn {
            width: 100%; padding: 12px; margin: 0; 
            border-radius: 12px; font-weight: bold; cursor: pointer; border: none;
            font-size: 0.95rem; transition: 0.2s;
        }
        .btn-outline { background: #fff; border: 2px solid #eee; color: #999; }
        .btn-fill { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(78, 204, 163, 0.4); }
        /* === 3. æ–°å¢ï¼šæ–‡æœ¬æ¡†æ ·å¼ (Soft Note Style) === */
        .survey-textarea {
            width: 100%;
            height: 80px;
            background: #fff;       /* çº¯ç™½çº¸å¼ æ„Ÿ */
            border: 2px solid #ebdccc; /* é…åˆæ ‡ç­¾çš„å¥¶èŒ¶è‰²è¾¹æ¡† */
            border-radius: 16px;
            padding: 12px 15px;
            font-size: 0.9rem;
            font-family: inherit;
            color: #5d4037;
            resize: none; /* ç¦æ­¢æ‹–æ‹½æ”¹å˜å¤§å° */
            outline: none;
            box-sizing: border-box; /* é˜²æ­¢è¾¹æ¡†æ’‘å¼€å¸ƒå±€ */
            margin-bottom: 5px;
            transition: 0.3s;
            line-height: 1.5;
        }

        .survey-textarea::placeholder {
            color: #d7ccc8; /* æµ…å’–è‰²æç¤ºæ–‡å­— */
        }

        .survey-textarea:focus {
            border-color: var(--primary); /* èšç„¦æ—¶å˜ç»¿ */
            box-shadow: 0 4px 12px rgba(78, 204, 163, 0.15);
            background: #f0fdf9; /* ææ·¡çš„ç»¿è‰²èƒŒæ™¯ */
        }

        /* åº•éƒ¨è…¾è®¯é—®å·çš„å°é“¾æ¥æ ·å¼ */
        .tencent-link-btn {
            display: block;
            text-align: center;
            margin-top: 15px;
            font-size: 0.8rem;
            color: #94a3b8;
            text-decoration: underline;
            text-underline-offset: 3px;
            cursor: pointer;
            border: none;
            background: none;
        }
    </style>
</head>
<body>

    <header>
        <button class="icon-btn" onclick="openHistory()">ğŸ“Š</button>
        <h1>Chewing</h1>
        <div class="header-right">
            <button class="icon-btn" onclick="openHelp()">â”</button>
            <button class="icon-btn" onclick="openSettings()">âš™ï¸</button>
        </div>
    </header>

    <main id="appContainer" class="state-bite">
        <div class="stats-pill">
            å£æ•°: <span id="dispBites">0</span> | æ—¶é•¿: <span id="dispTime">00:00</span>
        </div>
        <div class="circle-container">
            <div class="circle-bg"></div>
            <div class="circle-inner">
                <div class="instruction-main" id="mainText">Chewing</div>
                <div class="instruction-sub" id="subText">æ…¢é£Ÿä¼´ä¾£</div>
            </div>
        </div>
    </main>

    <div class="control-bar">
        <button id="btnMain" class="btn btn-primary" onclick="toggleState()">å¼€å§‹ç”¨é¤</button>
        <button id="btnFinish" class="btn btn-danger" style="display:none;" onclick="preFinishMeal()">ç»“æŸç”¨é¤</button>
    </div>

    <!-- åŸæœ‰åŸºç¡€å¼¹çª—ï¼ˆæ— ä¿®æ”¹ï¼‰ -->
    <div id="modalHelp" class="modal" onclick="if(event.target===this) closeModals()">
        <div class="modal-content">
            <h2>ä½¿ç”¨è¯´æ˜</h2>
            <div style="line-height:1.8; color:#666;">
                <p>1. <strong>è¿›é£Ÿ (ç»¿)</strong>: æ”¾å…¥ä¸€å£é£Ÿç‰©ã€‚</p>
                <p>2. <strong>å’€åš¼ (è“)</strong>: è·Ÿç€åœ†åœˆèŠ‚å¥å’€åš¼ã€‚</p>
                <p>3. <strong>ä¼‘æ¯ (æ©™)</strong>: åå’½ï¼Œæ·±å‘¼å¸ã€‚</p>
            </div>
            <button class="close-btn-full" onclick="closeModals()">å…³é—­</button>
        </div>
    </div>
    <div id="modalSettings" class="modal" onclick="if(event.target===this) closeModals()">
        <div class="modal-content">
            <!-- æ ‡é¢˜ï¼šæ”¹ä¸ºå·¦å¯¹é½ + ä¿®æ”¹æ–‡æ¡ˆ -->
            <h2 style="text-align: left; margin-bottom: 35px; margin-top: 5px;">å’€åš¼æ¬¡æ•°ï¼ˆç§’ï¼‰</h2>
            
            <div class="slider-group" style="margin: 0 0 30px 0;">
                <div class="slider-wrapper" style="gap:15px; align-items: center;">
                    <span style="font-size: 0.85rem; color: #94a3b8; width: 30px; text-align:right;">10s</span>
                    
                    <!-- ç›¸å¯¹å®šä½å®¹å™¨ï¼šç”¨äºç²¾ç¡®ç»‘å®šæ°”æ³¡å’Œæ»‘å— -->
                    <div style="flex: 1; position: relative; height: 30px; display: flex; align-items: center;">
                        
                        <!-- æ°”æ³¡ï¼šç§»é™¤ left:50% çš„ç¡¬ç¼–ç ï¼Œç¨åç”± JS æ§åˆ¶ -->
                        <div id="rangeBubble" class="range-bubble" style="bottom: 35px; margin: 0; left: 0;">30ç§’</div>
                        
                        <input type="range" id="chewRange" min="10" max="100" value="30" oninput="updateSettingsUI()" style="width: 100%; margin: 0; display:block;">
                    </div>

                    <span style="font-size: 0.85rem; color: #94a3b8; width: 35px;">100s</span>
                </div>
            </div>
            
            <!-- ç§»é™¤äº†ä¸‹æ–¹å¤šä½™çš„å°å­—è¯´æ˜ -->
            
            <button class="close-btn-full" onclick="closeModals()">ä¿å­˜</button>
        </div>
    </div>
    <div id="modalHistory" class="modal" onclick="if(event.target===this) closeModals()">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between;"><h2>è®°å½•</h2><button onclick="clearHistory()" style="color:red;border:none;background:none">æ¸…ç©º</button></div>
            <ul id="historyList" class="history-list"></ul>
            <button class="close-btn-full" onclick="closeModals()">å…³é—­</button>
        </div>
    </div>

    <!-- â˜…â˜…â˜… æ ¸å¿ƒï¼šæ‰“èµ / æ”¯ä»˜ / é—®å·å¼¹çª— â˜…â˜…â˜… -->
    <div id="modalGratuity" class="modal">
        <div class="modal-content">
            
            <!-- é¡µé¢1: é€‰æ‹©é¡µ -->
            <!-- é¡µé¢1: é€‰æ‹©é¡µ (Redesign Version) -->
            <div id="pageSelect">
                <!-- å¤´éƒ¨ -->
                <h2>åˆ›ä½œä¸æ˜“ï¼Œæ‰“èµä¸€ä¸‹</h2>
                <p class="warm-subtitle">
                    å¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªåº”ç”¨æœ‰å¸®åŠ©ï¼Œå¯ä»¥è¯·æˆ‘å–æ¯å’–å•¡ ğŸª
                </p>

                <!-- Dribbble é£æ ¼å¡ç‰‡ç»„ -->
                <div class="gratuity-row">
                    <!-- 1å…ƒï¼šæŸ æª¬é»„ä¸»é¢˜ -->
                    <div class="g-card g-card-1" onclick="toPay(3)">
                
                        <div class="g-price">3å…ƒ</div>
                        <div class="g-label">æ”¯æŒ</div>
                    </div>
                    
                    <!-- 9å…ƒï¼šé‡ç‚¹æ¨èï¼Œçˆ±å¿ƒç²‰ä¸»é¢˜ -->
                    <div class="g-card g-card-9" onclick="toPay(9)">
                        <!-- è¿™é‡Œçš„ transform ç”¨æ¥åˆ¶é€ æ›´å¼ºçƒˆçš„ç«‹ä½“è´´çº¸æ„Ÿ -->
                        
                        <div class="g-price">9 å…ƒ</div>
                        <div class="g-label">è¶…èµ</div>
                    </div>

                    <!-- é—®å·ï¼šå®‰é™çš„æ°”æ³¡ -->
                    <div class="g-card g-card-survey" onclick="toSurvey()">
                        
                        <div class="g-price">ä¸‹æ¬¡</div>
                        <div class="g-label">åé¦ˆå»ºè®®</div>
                    </div>
                </div>

                <!-- åº•éƒ¨å¼±åŒ–æŒ‰é’® -->
                <button class="btn-text-only" onclick="fullFinish()">è·³è¿‡ï¼Œç›´æ¥ç»“æŸ</button>
            </div>

            <!-- é¡µé¢2: æ‰«ç æ”¯ä»˜é¡µ -->
            <!-- é¡µé¢2: æ‰«ç æ”¯ä»˜é¡µ -->
            <div id="pagePay">
                
                <div class="pay-header">
                    è¯·æ‰«ç æ”¯ä»˜ <span class="pay-amount-text" id="payAmount">3.00</span> å…ƒ
                </div>

                <div class="pay-tabs">
                    <button class="tab-btn active" id="btnAli" onclick="switchPay('ali')">æ”¯ä»˜å®</button>
                    <button class="tab-btn" id="btnWx" onclick="switchPay('wx')">å¾®ä¿¡æ”¯ä»˜</button>
                </div>
                
                <div class="qr-box">
                    <img id="qrImg" src="./images/ali.jpg" class="qr-img">
                </div>
                
                <div class="verify-alert">
                    ä»˜æ¬¾æ ¡éªŒå®åï¼š<span id="payName" style="font-weight:bold">*æ´</span>
                </div>

                <!-- â˜… æ–°å¢ï¼šæˆªå›¾æ‰«ç æç¤ºè¯­ â˜… -->
                <p id="saveQRHint" style="font-size:0.8rem; color:#94a3b8; text-align:center; margin:15px 0 5px 0; line-height:1.4;">
                    æ‰‹æœºç«¯è¯·æˆªå›¾ä¿å­˜æ”¶æ¬¾ç åï¼Œ<br>ç”¨æ”¯ä»˜å®æ‰«ä¸€æ‰«ä»˜æ¬¾
                </p>

                <div style="display:flex; gap:10px; width:100%; margin-top:15px;">
                    <button class="close-btn-full" style="margin:0; background:white; border:1px solid #e2e8f0; color:#64748b;" onclick="showPage('pageSelect')">è¿”å›</button>
                    <button class="close-btn-full" style="margin:0; background:#333; color:white; border:1px solid #333;" onclick="fullFinish()">å·²å®Œæˆæ”¯ä»˜</button>
                </div>
            </div>

            <!-- é¡µé¢3: é—®å·è°ƒæŸ¥é¡µ -->
            <!-- é¡µé¢3: é—®å·è°ƒæŸ¥é¡µ -->
            <div id="pageSurvey" style="display:none;">
                <h3 style="color:#5d4037; margin-bottom:5px;">å»ºè®®åé¦ˆ</h3>
                <p style="color:#bcaaa4; font-size:0.8rem; text-align:center;">æ‚¨çš„æ¯ä¸€æ¡æ„è§æˆ‘ä»¬éƒ½ä¼šè®¤çœŸçœ‹~</p>
                
                <!-- é—®é¢˜ 1 -->
                <label class="survey-q-title">1. æ‚¨å¸Œæœ›è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ(å¤šé€‰)</label>
                <div class="tags-wrapper" id="tagsQ1">
                    <span class="survey-tag" onclick="toggleTag(this)">å‡è‚¥ç˜¦èº«</span>
                    <span class="survey-tag" onclick="toggleTag(this)">æ§åˆ¶è¿›é£Ÿé€Ÿåº¦</span>
                    <span class="survey-tag" onclick="toggleTag(this)">ç¼“è§£èƒƒèƒ€</span>
                    <span class="survey-tag" onclick="toggleTag(this)">æ­£å¿µé¥®é£Ÿ</span>
                    <span class="survey-tag" onclick="toggleTag(this)">å•çº¯å¥½å¥‡</span>
                </div>

                <!-- é—®é¢˜ 2 -->
                <label class="survey-q-title">2. ç›®å‰çš„èŠ‚å¥æ„Ÿå—å¦‚ä½•ï¼Ÿ(å•é€‰)</label>
                <div class="tags-wrapper" id="tagsQ2">
                    <span class="survey-tag" onclick="selectTag(this, 'tagsQ2')">éå¸¸æœ‰å¸®åŠ©</span>
                    <span class="survey-tag" onclick="selectTag(this, 'tagsQ2')">èŠ‚å¥å¾ˆèˆ’æœ</span>
                    <span class="survey-tag" onclick="selectTag(this, 'tagsQ2')">èŠ‚å¥å¤ªæ…¢äº†</span>
                    <span class="survey-tag" onclick="selectTag(this, 'tagsQ2')">èŠ‚å¥å¤ªå¿«äº†</span>
                </div>

                <!-- â˜…â˜…â˜… é—®é¢˜ 3 (æ–°å¢) â˜…â˜…â˜… -->
                <label class="survey-q-title">3. è¿˜æœ‰ä»€ä¹ˆæƒ³è¯´çš„ï¼Ÿ</label>
                <textarea id="txtQ3" class="survey-textarea" placeholder="ä»»ä½•åŠŸèƒ½å»ºè®®æˆ–åæ§½..."></textarea>

                <!-- åº•éƒ¨æŒ‰é’® -->
                <div style="display:flex; gap:12px; margin-top:20px;">
                    <button class="modal-action-btn btn-outline" onclick="showPage('pageSelect')">è¿”å›</button>
                    <!-- ç‚¹å‡»æ­¤æŒ‰é’®å°†ç”Ÿæˆé‚®ä»¶ -->
                    <button class="modal-action-btn btn-fill" onclick="submitSurvey()">ç”Ÿæˆé‚®ä»¶åé¦ˆ</button>
                </div>
                
                <!-- é“¾æ¥åˆ°æ‚¨çš„è…¾è®¯é—®å· -->
                <button class="tencent-link-btn" onclick="openExternalSurvey()">è·³è½¬åˆ°ç½‘é¡µç‰ˆé—®å· ></button>
            </div>

        </div>
    </div>

    <script>
        // === 1. åŸæœ‰åŸºç¡€ JS é€»è¾‘ (è®¡æ—¶ã€åŠ¨ç”»ã€çŠ¶æ€) ===
        let config = { biteTime: 3000, chewTime: 30000, restTime: 5000 };
        let state = { isRunning: false, isPaused: false, bites: 0, totalSeconds: 0, timerInterval: null, phaseTimeout: null };
        const els = {
            container: document.getElementById('appContainer'), mainText: document.getElementById('mainText'), subText: document.getElementById('subText'),
            btnMain: document.getElementById('btnMain'), btnFinish: document.getElementById('btnFinish'),
            dispBites: document.getElementById('dispBites'), dispTime: document.getElementById('dispTime'),
            modalGratuity: document.getElementById('modalGratuity')
        };

        function toggleState() { !state.isRunning ? startMeal() : state.isPaused ? resumeMeal() : pauseMeal(); }
        function startMeal() { state.isRunning = true; state.isPaused = false; state.bites = 0; state.totalSeconds = 0; updateStats(); els.btnMain.innerText = "æš‚åœ"; els.btnMain.className = "btn btn-secondary"; els.btnFinish.style.display = "block"; if(state.timerInterval) clearInterval(state.timerInterval); state.timerInterval = setInterval(() => { state.totalSeconds++; updateStats(); }, 1000); runPhase('bite'); }
        function pauseMeal() { state.isPaused = true; clearTimeout(state.phaseTimeout); els.btnMain.innerText = "ç»§ç»­"; els.btnMain.className = "btn btn-primary"; els.mainText.innerText = "å·²æš‚åœ"; els.subText.innerText = "è°ƒæ•´å‘¼å¸"; els.container.className = "state-rest"; }
        function resumeMeal() { state.isPaused = false; els.btnMain.innerText = "æš‚åœ"; els.btnMain.className = "btn btn-secondary"; runPhase('bite'); }
        function fullFinish() { 
            saveHistory(); 
            clearInterval(state.timerInterval); clearTimeout(state.phaseTimeout); 
            state.isRunning = false; state.isPaused = false; els.btnMain.innerText = "å¼€å§‹ç”¨é¤"; els.btnMain.className = "btn btn-primary"; els.btnFinish.style.display = "none"; els.container.className = "state-rest"; els.mainText.innerText = "Chewing"; els.subText.innerText = "æ…¢é£Ÿä¼´ä¾£"; 
            els.modalGratuity.classList.remove('active'); // å…³å¼¹çª—
        }
        function runPhase(phase) {
            if (!state.isRunning || state.isPaused) return;
            let duration = phase === 'bite' ? config.biteTime : phase === 'chew' ? config.chewTime : config.restTime;
            if (phase === 'bite') { els.container.className = "state-bite"; els.mainText.innerText = "åƒä¸€å£"; els.subText.innerText = "æ”¾å…¥é£Ÿç‰©"; state.phaseTimeout = setTimeout(() => { state.bites++; updateStats(); runPhase('chew'); }, duration); } 
            else if (phase === 'chew') { els.container.className = "state-chew"; els.mainText.innerText = "ç»†åš¼æ…¢å’½"; els.subText.innerText = "äº«å—æ»‹å‘³"; state.phaseTimeout = setTimeout(() => { runPhase('rest'); }, duration); } 
            else if (phase === 'rest') { els.container.className = "state-rest"; els.mainText.innerText = "åå’½"; els.subText.innerText = "æ”¾æ¾å‘¼å¸"; state.phaseTimeout = setTimeout(() => { runPhase('bite'); }, duration); }
        }
        function updateStats() { els.dispBites.innerText = state.bites; const m = Math.floor(state.totalSeconds / 60).toString().padStart(2, '0'); const s = (state.totalSeconds % 60).toString().padStart(2, '0'); els.dispTime.innerText = `${m}:${s}`; }

        /* === 2. å¼¹çª—å’Œæ–°åŠŸèƒ½ JS é€»è¾‘ === */
        
        // ç»“æŸå‰è§¦å‘æ‰“èµå¼¹çª—
        function preFinishMeal() { pauseMeal(); showPage('pageSelect'); els.modalGratuity.classList.add('active'); }

        // é¡µé¢åˆ‡æ¢
        function showPage(id) {
            ['pageSelect', 'pagePay', 'pageSurvey'].forEach(pid => document.getElementById(pid).style.display = 'none');
            document.getElementById(id).style.display = 'flex'; // surveyå’Œpayä½¿ç”¨äº†flexå¸ƒå±€æˆ–è€…column
            if(id === 'pageSurvey' || id === 'pageSelect') document.getElementById(id).style.display = 'block';
            if(id === 'pagePay') document.getElementById(id).style.display = 'flex';
        }

        // æ”¯ä»˜é€»è¾‘
        // æ”¯ä»˜é€»è¾‘ - æ›´æ–°ç‰ˆ
        function toPay(amt) {
            document.getElementById('payAmount').innerText = amt + ".00";
            // é»˜è®¤è¿›å…¥æ—¶é‡ç½®ä¸ºæ”¯ä»˜å®ï¼Œå¹¶è°ƒç”¨ switchPay æ›´æ–°æ–‡å­—
            switchPay('ali'); 
            showPage('pagePay');
        }

        function switchPay(type) {
            // é‡ç½® Tab æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            // è·å–éœ€è¦æ“ä½œçš„ DOM å…ƒç´ 
            const qrImg = document.getElementById('qrImg');
            const payName = document.getElementById('payName');
            const hintText = document.getElementById('saveQRHint'); // è·å–æç¤ºè¯­æ ‡ç­¾

            if(type === 'ali') {
                // === åˆ‡æ¢åˆ°æ”¯ä»˜å® ===
                document.getElementById('btnAli').classList.add('active');
                qrImg.src = './images/ali.jpg';
                payName.innerText = '*æ´';
                // â˜… æ›´æ–°æç¤ºè¯­
                hintText.innerHTML = 'æ‰‹æœºç«¯è¯·æˆªå›¾ä¿å­˜æ”¶æ¬¾ç åï¼Œ<br>ç”¨ <b>æ”¯ä»˜å®</b> æ‰«ä¸€æ‰«ä»˜æ¬¾';
            } else {
                // === åˆ‡æ¢åˆ°å¾®ä¿¡ ===
                document.getElementById('btnWx').classList.add('active');
                qrImg.src = './images/wx.jpg';
                payName.innerText = 'æ¨æ¨(*æ´)';
                // â˜… æ›´æ–°æç¤ºè¯­
                hintText.innerHTML = 'æ‰‹æœºç«¯è¯·æˆªå›¾ä¿å­˜æ”¶æ¬¾ç åï¼Œ<br>ç”¨ <b>å¾®ä¿¡</b> æ‰«ä¸€æ‰«ä»˜æ¬¾';
            }
        }

        // é—®å·é€»è¾‘
        function toSurvey() { showPage('pageSurvey'); }
        function toggleTag(el) { el.classList.toggle('active'); } // å¤šé€‰
        function selectTag(el, pid) { 
            document.getElementById(pid).querySelectorAll('.survey-tag').forEach(t=>t.classList.remove('active'));
            el.classList.add('active'); // å•é€‰
        }
        
        /* é—®å·æ–°é€»è¾‘ï¼šæ”¯æŒè·³è½¬ URL + è·å–æ–‡æœ¬æ¡†å†…å®¹ */
        function openExternalSurvey() {
            // ç›´æ¥åœ¨æ–°çª—å£æ‰“å¼€æ‚¨æä¾›çš„è…¾è®¯é—®å·é“¾æ¥
            window.open('https://wj.qq.com/s2/24989756/6be9/', '_blank');
        }

        function submitSurvey() {
            // è·å– Tag æ•°æ®
            let q1 = []; 
            document.querySelectorAll('#tagsQ1 .survey-tag.active').forEach(t=>q1.push(t.innerText));
            let q2 = []; 
            document.querySelectorAll('#tagsQ2 .survey-tag.active').forEach(t=>q2.push(t.innerText));
            
            // â˜… è·å–æ–‡æœ¬æ¡†æ•°æ®
            let q3Text = document.getElementById('txtQ3').value;

            // å¦‚æœå…¨éƒ¨ä¸ºç©ºï¼Œæç¤ºä¸€ä¸‹
            if(q1.length === 0 && q2.length === 0 && !q3Text.trim()) { 
                alert('è¿˜æ˜¯å†™ç‚¹ä»€ä¹ˆå†èµ°å§~'); 
                return; 
            }

            // æ„å»ºé‚®ä»¶å†…å®¹
            const subject = "Chewing ç”¨æˆ·åé¦ˆ";
            const body = 
`Chewing åé¦ˆæŠ¥å‘Š:
-------------------------
1. å¸Œæœ›è§£å†³:
${q1.join(', ') || 'æœªé€‰æ‹©'}

2. ä½¿ç”¨æ„Ÿå—:
${q2.join(', ') || 'æœªé€‰æ‹©'}

3. è¯¦ç»†å»ºè®®:
${q3Text || 'æ— '}
-------------------------
(è‡ªåŠ¨ç”Ÿæˆï¼Œç‚¹å‡»å‘é€å³å¯)`;
            
            // æ‹‰èµ·é‚®ç®±
            window.location.href = `mailto:2753669992@qq.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // ç®€å•çš„ UI åé¦ˆ
            setTimeout(() => { 
                alert('å·²ä¸ºæ‚¨ç”Ÿæˆé‚®ä»¶è‰ç¨¿ï¼Œè¯·åœ¨é‚®ä»¶ App ä¸­ç‚¹å‡»å‘é€ã€‚\næˆ–è€…æ‚¨å¯ä»¥ç‚¹å‡»åº•éƒ¨çš„é“¾æ¥å¡«å†™åœ¨çº¿é—®å·ã€‚'); 
                // å¯é€‰ï¼šå‘é€åæ˜¯å¦è‡ªåŠ¨è·³è½¬å›ç»“æŸé¡µï¼Ÿç›®å‰ä¿ç•™åœ¨é—®å·é¡µæ–¹ä¾¿ç”¨æˆ·æŸ¥çœ‹
            }, 800);
        }

        // æ‚é¡¹
        function saveHistory() { if(state.bites===0)return; let h=JSON.parse(localStorage.getItem('savorHistory')||'[]'); h.unshift({date:new Date().toLocaleString('zh-CN'), bites:state.bites, duration:state.totalSeconds}); if(h.length>20)h.pop(); localStorage.setItem('savorHistory',JSON.stringify(h)); }
        function openSettings(){document.getElementById('modalSettings').classList.add('active'); updateSettingsUI();}
        function closeModals(){document.querySelectorAll('.modal').forEach(m=>m.classList.remove('active'));}
        function updateSettingsUI() {
            const range = document.getElementById('chewRange');
            const bubble = document.getElementById('rangeBubble');
            
            const val = parseInt(range.value);
            const min = parseInt(range.min);
            const max = parseInt(range.max);
            
            // 1. æ›´æ–°æ•°å€¼æ–‡æœ¬
            bubble.innerText = val + 'ç§’'; 
            
            // 2. æ›´æ–°é…ç½®
            config.chewTime = val * 1000; 

            // 3. è®¡ç®—ç™¾åˆ†æ¯”ä½ç½® (0 - 100)
            const percent = ((val - min) * 100) / (max - min);
            
            // 4. è®¾ç½®æ°”æ³¡ä½ç½®ï¼š
            // percent + "%" å®šä½æ°”æ³¡å·¦ä¾§è¾¹ç¼˜åˆ°æ»‘å—ä¸­å¿ƒä½ç½®
            // translateX(-50%) åœ¨ CSS ä¸­è´Ÿè´£å°†æ°”æ³¡è‡ªèº«å±…ä¸­
            bubble.style.left = percent + "%"; 
        }
        function openHistory(){let l=document.getElementById('historyList'); l.innerHTML=''; JSON.parse(localStorage.getItem('savorHistory')||'[]').forEach(i=>l.innerHTML+=`<li class="history-item"><span>${i.date}</span><span>${i.bites}å£</span></li>`); document.getElementById('modalHistory').classList.add('active');}
        function clearHistory(){localStorage.removeItem('savorHistory'); openHistory();}
        function openHelp(){document.getElementById('modalHelp').classList.add('active');}
    </script>
</body>
</html>